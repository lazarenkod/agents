---
name: analyze-container-security
description: Комплексный анализ безопасности системы контейнеризации на соответствие требованиям ФСТЭК России с автоматической генерацией отчетов
---

# Анализ безопасности контейнеров по требованиям ФСТЭК

Эта команда запускает полный цикл анализа системы контейнеризации на соответствие требованиям ФСТЭК России (Приказ № 118 от 04.07.2022).

## Что делает команда

1. **Собирает информацию о системе**
   - Определяет тип системы контейнеризации (Docker, Kubernetes, Podman)
   - Идентифицирует версии компонентов
   - Собирает информацию о конфигурациях

2. **Проводит технический анализ**
   - Сканирует образы на уязвимости
   - Анализирует конфигурации безопасности
   - Проверяет RBAC настройки (для Kubernetes)
   - Оценивает сетевую изоляцию
   - Проверяет настройки логирования

3. **Сопоставляет с требованиями ФСТЭК**
   - Проверяет соответствие всем категориям требований
   - Идентифицирует несоответствия
   - Классифицирует по критичности

4. **Генерирует отчетность**
   - Аудиторское заключение
   - Технический отчет
   - Матрица соответствия
   - План устранения несоответствий

## Использование

### Базовый запуск
```
/analyze-container-security
```

Команда интерактивно запросит необходимую информацию:
- Тип системы контейнеризации
- Требуемый уровень защищенности (УЗ-1 до УЗ-4)
- Путь к конфигурациям (опционально)

### Расширенный запуск с параметрами

```
/analyze-container-security --type kubernetes --level УЗ-3 --namespace production
```

**Доступные параметры:**

- `--type` : Тип системы (docker, kubernetes, podman)
- `--level` : Уровень защищенности (УЗ-1, УЗ-2, УЗ-3, УЗ-4)
- `--namespace` : Kubernetes namespace для анализа (по умолчанию: все)
- `--output` : Директория для сохранения отчетов (по умолчанию: ./fstec-reports)
- `--config` : Путь к конфигурационным файлам
- `--images` : Сканировать образы на уязвимости (true/false, по умолчанию: true)
- `--full` : Полный аудит с формированием всех документов (по умолчанию: true)

## Процесс выполнения

### Этап 1: Сбор информации (2-5 минут)

Команда запросит следующую информацию:

1. **Общие сведения**
   - Наименование системы
   - Версия
   - Окружение (development/staging/production)
   - Требуемый уровень защищенности

2. **Технические детали**
   - Платформа контейнеризации
   - Версия платформы
   - Список основных компонентов
   - Доступ к системе (для автоматического анализа)

### Этап 2: Автоматический анализ (5-15 минут)

Команда автоматически:

1. **Анализирует конфигурации**
   ```
   ✓ Проверка Docker/Podman конфигураций
   ✓ Анализ Kubernetes manifests
   ✓ Проверка RBAC настроек
   ✓ Анализ Network Policies
   ✓ Проверка SecurityContext
   ```

2. **Сканирует образы** (если включено)
   ```
   ✓ Сканирование образов с Trivy
   ✓ Поиск критичных уязвимостей
   ✓ Проверка устаревших зависимостей
   ✓ Анализ секретов в образах
   ```

3. **Проверяет runtime**
   ```
   ✓ Анализ запущенных контейнеров
   ✓ Проверка capabilities
   ✓ Анализ volume mounts
   ✓ Проверка сетевых настроек
   ```

### Этап 3: Сопоставление с ФСТЭК (5-10 минут)

Для каждой категории требований:

```
Идентификация и аутентификация (ИА)
  ✓ ИА.1 - Идентификация субъектов доступа
  ✓ ИА.2 - Аутентификация субъектов доступа
  ⚠ ИА.3 - Управление учетными записями
  ...

Управление доступом (УД)
  ✓ УД.1 - Разграничение доступа
  ❌ УД.2 - Изоляция процессов
  ...

[и так далее для всех категорий]
```

### Этап 4: Генерация отчетов (2-5 минут)

Создаются следующие документы:

```
fstec-reports/
├── audit-conclusion-2025-11-20.md       # Аудиторское заключение
├── technical-analysis-2025-11-20.md     # Технический отчет
├── compliance-matrix-2025-11-20.md      # Матрица соответствия
├── remediation-plan-2025-11-20.md       # План устранения
├── evidence/                             # Доказательства
│   ├── configurations/
│   ├── scan-results/
│   └── screenshots/
└── summary-2025-11-20.md                # Краткая сводка
```

## Интерпретация результатов

### Краткая сводка

После выполнения команда выводит краткую сводку:

```markdown
╔═══════════════════════════════════════════════════════════════╗
║       РЕЗУЛЬТАТЫ АНАЛИЗА СООТВЕТСТВИЯ ТРЕБОВАНИЯМ ФСТЭК       ║
╚═══════════════════════════════════════════════════════════════╝

Система: Production Kubernetes Cluster
Уровень защищенности: УЗ-3
Дата анализа: 2025-11-20

┌───────────────────────────────────────────────────────────────┐
│ ОБЩАЯ СТАТИСТИКА                                              │
├───────────────────────────────────────────────────────────────┤
│ Всего требований:        87                                   │
│ Соответствует:          45 (52%)  ████████████░░░░░░░░░░░░    │
│ Частично соответствует: 28 (32%)  ███████░░░░░░░░░░░░░░░░░   │
│ Не соответствует:       14 (16%)  ████░░░░░░░░░░░░░░░░░░░░   │
└───────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────┐
│ КРИТИЧНОСТЬ НЕСООТВЕТСТВИЙ                                    │
├───────────────────────────────────────────────────────────────┤
│ 🔴 Критичные:  3                                              │
│ 🟠 Высокие:    8                                              │
│ 🟡 Средние:   18                                              │
│ 🟢 Низкие:    13                                              │
└───────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────┐
│ ТОП-3 КРИТИЧНЫХ ПРОБЛЕМ                                       │
├───────────────────────────────────────────────────────────────┤
│ 1. Отсутствие Network Policies (УД.7)                        │
│    └─ Риск: Отсутствие сетевой изоляции между контейнерами  │
│                                                               │
│ 2. Привилегированные контейнеры (УД.2)                       │
│    └─ Риск: Возможность escalation на хост                   │
│                                                               │
│ 3. Отсутствие централизованного логирования (РУ.3)           │
│    └─ Риск: Невозможность расследования инцидентов           │
└───────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────┐
│ ГОТОВНОСТЬ К СЕРТИФИКАЦИИ                                     │
├───────────────────────────────────────────────────────────────┤
│ Статус: ⚠️  ТРЕБУЕТСЯ ДОРАБОТКА                              │
│                                                               │
│ Для достижения соответствия необходимо устранить:            │
│ - Все критичные несоответствия (3)                           │
│ - Все высокие несоответствия (8)                             │
│                                                               │
│ Ориентировочный срок: 2-3 месяца                             │
└───────────────────────────────────────────────────────────────┘

📄 Полные отчеты сохранены в: ./fstec-reports/
```

### Статусы соответствия

- ✅ **Соответствует** - требование полностью выполнено
- ⚠️ **Частично соответствует** - требование выполнено не полностью
- ❌ **Не соответствует** - требование не выполнено
- ➖ **Не применимо** - требование не применимо к данной системе

### Уровни критичности

- 🔴 **Критичный** - блокирует сертификацию, требует немедленного устранения
- 🟠 **Высокий** - существенное нарушение, устранить в приоритетном порядке
- 🟡 **Средний** - рекомендуется устранить для повышения уровня защиты
- 🟢 **Низкий** - желательно устранить, не критично

## Следующие шаги

После получения результатов анализа:

1. **Ознакомьтесь с аудиторским заключением**
   - Откройте `audit-conclusion-YYYY-MM-DD.md`
   - Изучите общую оценку и выводы

2. **Проанализируйте критичные проблемы**
   - Откройте `remediation-plan-YYYY-MM-DD.md`
   - Начните с критичных и высоких несоответствий

3. **Изучите технические детали**
   - Откройте `technical-analysis-YYYY-MM-DD.md`
   - Просмотрите конкретные конфигурации и рекомендации

4. **Используйте матрицу соответствия**
   - Откройте `compliance-matrix-YYYY-MM-DD.md`
   - Используйте как чек-лист при устранении проблем

5. **Запланируйте работы**
   - Используйте план устранения несоответствий
   - Назначьте ответственных и сроки
   - Отслеживайте прогресс

6. **Проведите повторный анализ**
   - После устранения проблем запустите команду снова
   - Убедитесь, что проблемы устранены
   - Получите финальное заключение

## Примеры использования

### Пример 1: Анализ Docker окружения

```bash
/analyze-container-security --type docker --level УЗ-4
```

### Пример 2: Анализ конкретного Kubernetes namespace

```bash
/analyze-container-security --type kubernetes --level УЗ-2 --namespace production
```

### Пример 3: Быстрый анализ без сканирования образов

```bash
/analyze-container-security --type kubernetes --images false
```

### Пример 4: Анализ с указанием конфигураций

```bash
/analyze-container-security --config ./k8s-manifests --output ./reports
```

## Требования

### Для Docker анализа:
- Docker CLI установлен и доступен
- Доступ к Docker daemon
- (Опционально) Trivy для сканирования образов

### Для Kubernetes анализа:
- kubectl настроен и имеет доступ к кластеру
- Права на чтение ресурсов в проверяемых namespaces
- (Опционально) Kube-bench для проверки CIS benchmarks

### Для Podman анализа:
- Podman CLI установлен и доступен
- Доступ к Podman сокету

## Устранение проблем

### Проблема: Недостаточно прав доступа
```
Решение: Убедитесь, что у вас есть права для чтения конфигураций
и запуска сканирующих инструментов
```

### Проблема: Сканирование образов не работает
```
Решение: Установите Trivy или отключите сканирование флагом --images false
```

### Проблема: Не найдены конфигурации
```
Решение: Укажите явно путь к конфигурациям через --config
```

## Интеграция с другими командами

- `/generate-compliance-report` - Генерация дополнительных отчетов
- `/remediate-findings` - Автоматическое исправление проблем
- `/track-compliance` - Отслеживание прогресса устранения

## Дополнительная информация

- Документация ФСТЭК: https://fstec.ru/
- Требования № 118: https://fstec.ru/dokumenty/...
- Best practices контейнерной безопасности: `skills/container-security-best-practices`
